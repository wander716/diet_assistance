# 三、技术实现

## 3.1 核心工具

### 3.1.1 阿里百炼平台

我们本次设计通过阿里云百炼平台进行，其核心优势在于可视化的工作流编排能力，允许我们以低代码的方式，将大模型、API调用、条件判断、代码脚本等功能模块像积木一样搭建和连接。这不仅极大地提升了开发效率和调试速度，也使得复杂的 Agent 内部逻辑变得清晰、可管理。同时，依托于阿里平台丰富的应用生态，百炼提供了许多功能丰富、开箱即用的工具，为我们的功能实现提供了很大的便利，我们本次使用了路径规划、高德地图和今天吃什么 MCP 辅助我们的智能体开发。

### 3.1.2 通义千问大模型

我们选用通义千问大模型作为本次智能体开发的基础。该模型是阿里巴巴集团自主研发的大语言模型体系，具备强大的理解、生成与处理自然语言和代码的能力，在多项权威评测和实际应用中表现出卓越的性能。通义千问支持超长上下文推理，可处理长达数百万token的文本，进行高效分析与内容生成。

### 3.1.3 外部 API

Spoonacular 是一个功能极其强大的食品、营养和食谱数据 API，为开发者、营养师、食品博主、健身应用和任何对食品数据感兴趣的人提供了一个庞大的数据库和一系列工具。其拥有一个包含超过 36 万份食谱的庞大数据库，每份食谱均配有标题、图片、食材清单、具体用量、烹饪步骤、准备时间、难度等级及详细营养成分等完整信息。其先进的智能搜索不仅支持按菜名查询，还能根据用户现有食材进行个性化推荐，同时提供精细的高级过滤功能，可依据饮食要求、菜系风味、过敏原限制及营养成分需求进行多维度筛选。系统还集成了涵盖数千种食材的详细营养数据库（包括热量、蛋白质、脂肪、碳水化合物、维生素和矿物质等），支持对任意食谱或组合餐品进行总营养含量计算。

## 3.2 实现开展

### 3.2.1 大体框架

我们构建了一个“总指挥智能体 + 多个专业工作流”的协同任务处理体系。在这个体系中，顶层智能体作为统一入口，负责接收用户请求、理解真实意图，并进行智能任务规划与任务分发；而各项专业任务则由对应的专项工作流精细处理，包括调用本地餐厅推荐（集成高德地图API）、生成个性化菜谱（通过“今天吃什么”MCP）、查询营养成分（接入Spoonacular API）以及进行路径规划（使用路径规划MCP）等。每个工作流职责清晰、功能专注，既可独立优化也可灵活复用，最终通过统一的前端渠道（网页和微信公众号）为用户提供便捷高效的服务体验。

### 3.2.2 提示词设置

#### 智能体层提示词

通过提示词注入赋予顶层智能体“知食”的完整的角色设置和人格品质，如“你的最高使命是：通过科学、个性化且充满乐趣的饮食指导，赋能用户建立与食物之间更健康、更愉悦的关系”“共情: 你能理解用户在饮食管理中可能遇到的困惑、挫败感和喜悦；耐心: 你从不厌烦用户的重复提问或初步的知识盲点；风趣: 在保持专业的同时，你的语言风格带有一丝轻快的风趣”；

规定其回答的边界，如“对医疗相关问题，须建议用户咨询专业人士”，以保证用户的健康与安全；

为其设定了清晰的决策框架，智能判断用户的请求是否与所接入的工作流功能相关，如果是则根据具体情况调用工作流，反之则基于自身角色设置回答用户的问题，并引导用户提问与“知食”智能体核心功能相关的问题。

#### 工作流层提示词

在工作流内部，我们为不同的大模型节点设计了高度功能化的提示词。例如，“参数提取”节点的提示词包含了多个示例，严格规定了输出的 JSON 格式和每个字段的提取规则，确保了结构化数据的稳定输出。而“结果输出”节点的提示词则侧重于风格转换和数据总结，确保了智能体输出的最终质量，提高用户体验感。

### 3.2.3 工作流搭建

#### 查询营养工作流

输入 -> 食物名称提取 -> 调用 Spoonacular API 查询 -> 优化结果输出

该工作流聚焦于 “快速获取食物精准营养数据”，通过标准化的输入解析与接口调用，为用户提供清晰、实用的营养信息，适用于日常饮食规划、热量控制等场景。

输入：支持多样化输入形式，包括用户直接输入的单一食物名称、包含食物的短句，甚至是模糊表述（如 “早餐喝的牛奶有多少钙”），系统会先对输入内容进行初步语义识别，过滤无关信息（如 “想知道” 等语气词），确保后续提取的准确性。

食物名称提取：通过大模型的语义分析功能，精准提取用户想要查询的对象。

调用 Spoonacular API 查询：将提取到的 “食物名称” 转化为 API 可识别的参数格式，通过接口向 Spoonacular 平台发起请求。该 API 会返回丰富的营养数据，包括热量、蛋白质、碳水化合物、脂肪、维生素、矿物质等，满足用户的不同需求。



#### 菜谱生成工作流

输入 -> 菜谱名称提取 -> 调用 今天吃什么 MCP 查询 -> 优化结果输出

该工作流聚焦于 “满足用户个性化菜谱需求”，通过精准的需求解析与微服务调用，为用户提供适配场景、易落地的菜谱方案，适用于日常烹饪、特殊饮食（如“减脂”“增肌”）等场景。​

输入：支持多维度输入形式，包括直接的菜谱名称（如优化结果输出：对 API 返回的原始数据进行处理，剔除冗余字段，将专业数值转化为用户易理解的表述，并根据用户潜在需求增加延伸建议。“可乐鸡翅”）、基于食材的需求（如“用鸡胸肉做一道菜”）、基于场景的需求（如“提供减脂的晚餐食谱”），甚至是混合需求（如“用虾仁、西兰花做减脂餐”），系统会初步过滤无关表述（如“帮我找”“想要”等），保障需求解析的精准度。​

菜谱名称提取：通过大模型的语义拆解与关键词映射功能，精准提取用户核心诉求对应的菜谱方向。若输入模糊需求（如 “用土豆做家常菜”），会先拆解 “食材（土豆）+ 场景（家常菜）”，再匹配出适配的菜谱名称；若输入明确菜谱名，则直接提取核心名称。
​
调用 今天吃什么 MCP 查询：将提取的“菜谱名称/需求关键词”转化为 MCP 可识别的参数格式，向“今天吃什么 MCP”发起请求。该 MCP 会返回完整菜谱信息，包括食材清单（含详细分量）、分步做法（附带烹饪技巧）、烹饪时间、难度等级，部分还提供替代食材建议，满足落地需求。​

优化结果输出：对 MCP 返回的原始菜谱数据进行处理，将复杂步骤简化为短句并补充关键提示，增加场景适配建议，让菜谱更贴合用户实际烹饪情况。

#### 当地餐厅推荐工作流

输入 -> 餐厅地点和类型提取 -> 参数提取 -> 调用 高德地图 MCP -> 优化结果输出

该工作流聚焦于 “精准推荐本地适配餐厅”，通过多维度信息解析与地图服务调用，为用户解决“去哪吃、吃什么”问题，适用于日常聚餐、异地出行等场景。​

输入：支持“位置+偏好”的输入形式，系统会初步筛选无效信息（如 “麻烦推荐”“帮我找” 等），确保信息提取的有效性。​

餐厅地点和类型提取：通过大模型的地理信息解析与偏好关键词识别功能，精准提取核心信息。验证并确定位置范围，提取餐厅类型偏好，保障后续参数提取的准确性。
​
参数提取：将提取的“位置+偏好”转化为标准化参数，为调用 MCP 做准备。​

调用 高德地图 MCP：将标准化参数传入高德地图 MCP，该 MCP 会返回符合条件的餐厅列表，包含基础信息（名称、地址、营业时间）、核心数据（人均、评分）、辅助信息（距离、导航路线、实时排队状态），满足用户决策需求。
​
优化结果输出：对 MCP 返回的餐厅数据进行处理，智能排序餐厅列表，同时补充决策建议，提升用户选择效率。

该功能可以和智能体接入的“路径规划” MCP 联合使用，实现由“食”到“行”的合一。

## 3.3 总结和优化

相较于在课堂展示中所呈现的单一工作流，我们通过将其拆分为不同功能模块的多条工作流，并进一步修改优化提示词，让大语言模型可以根据用户输入的具体情况，智能选择调用工作流，实现了在一次交互中调用多个不同工作流和调用同一功能工作流多次，使得不同分支工作流之间可以联动使用，提高其智能性，简单的闲聊则由顶层智能体直接处理，避免了不必要的资源消耗，提高了运行效率，综合提升用户体验。并且，每个专业工作流都是一个高度优化、职责单一的模块，内部封装了从参数提取、API调用到结果处理等完整的多步逻辑，各功能模块相互独立，调试和优化更为精准，未来新增功能只需增加新的工作流，而无需改动整体框架，极大地提升了系统的可维护性和可扩展性。